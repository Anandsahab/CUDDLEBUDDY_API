<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>KRLE KAAM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css"
    />

    <!-- <link rel="stylesheet" href="/static/css/sign.css"> -->
    <link rel="stylesheet" href="/static/css/sgn.css" />
  </head>

  <body>
    <!-- {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %} -->
    <div class="signup-container">
      <div class="signup-header">
        <h2>Create Account</h2>
        <p>Join our pet adoption community</p>
      </div>

      <form action="{{ url_for('signup') }}" method="POST">
        <div class="form-box">
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input
              type="text"
              name="username"
              placeholder="Username"
              required
            />
          </div>
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input
              type="email"
              name="email"
              placeholder="Email Address"
              required
            />
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              name="password"
              placeholder="Password"
              required
            />
          </div>
          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              name="confirm_password"
              placeholder="Confirm Password"
              required
            />
          </div>
          <!-- <div class="input-group select-group">
            <i class="fas fa-user-tag"></i>
            <select name="role" required>
              <option value="">Select Role</option>
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div> -->
					
					<div class="input-group ">
						<i class="fas fa-user-tag"></i>
						<select name="Answer " required>
							<option value="">Have you ever had a pet before?</option>
							<option value="user">Yes</option>
							<option value="admin">No</option>
					</div>
					</select>
				</div>
			</div>

        <button type="submit" class="btn">Create Account</button>
		{% with messages = get_flashed_messages(with_categories=true) %} {% if
			messages %}
			<div class="flash-messages">
			  {% for category, message in messages %}
			  <div class="alert alert-{{ category }}">{{ message }}</div>
			  {% endfor %}
			</div>
			{% endif %} {% endwith %}

        <div class="login-link">
          Already have an account? <a href="{{ url_for('login') }}">Login</a>
        </div>
      </form>
    </div>
    <script>
      // Add this to your frontend JavaScript file that handles the signup form

      document.addEventListener('DOMContentLoaded', function() {
          const signupForm = document.getElementById('signupForm');
          
          if (signupForm) {
              signupForm.addEventListener('submit', function(e) {
                  e.preventDefault();
                  
                  // Get form data
                  const username = document.getElementById('username').value;
                  const email = document.getElementById('email').value;
                  const password = document.getElementById('password').value;
                  const confirmPassword = document.getElementById('confirm_password').value;
                  
                  // Create request payload
                  const data = {
                      username: username,
                      email: email,
                      password: password,
                      confirm_password: confirmPassword
                  };
                  
                  // Send API request
                  fetch('/api/signup', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify(data)
                  })
                  .then(response => {
                      // First check if the response is ok (status in 200-299 range)
                      if (!response.ok) {
                          // If not ok, try to parse the JSON anyway to get the error message
                          return response.json().then(errorData => {
                              throw new Error(errorData.error || 'Signup failed');
                          });
                      }
                      return response.json();
                  })
                  .then(data => {
                      if (data.success) {
                          // Handle successful signup
                          alert('Signup successful! Please log in.');
                          window.location.href = '/login'; // Redirect to login page
                      } else {
                          // Handle unsuccessful signup with a provided error message
                          alert('Signup failed: ' + data.error);
                      }
                  })
                  .catch(error => {
                      // Handle any errors in the fetch or json parsing
                      console.error('Error:', error);
                      alert('Signup failed: ' + error.message);
                  });
              });
          }
      });
    </script>
</body>
</html>